# MoltBot Guardian - Docker Compose
# Usage: CLAWDBOT_API_TOKEN=$(jq -r '.gateway.auth.token' ~/.clawdbot/clawdbot.json) docker compose up -d

services:
  guardian:
    build: .
    image: moltbot-guardian:latest
    container_name: moltbot-guardian
    ports:
      - "127.0.0.1:5050:5050"  # Localhost only - not exposed to network
    volumes:
      - ~/.clawdbot:/data:ro
      - guardian-data:/home/moltbot
    environment:
      MOLTBOT_HOST: "0.0.0.0"  # Inside container; external access controlled by port binding above
      MOLTBOT_PORT: "5050"
      CLAWDBOT_DIR: "/data"
      # Required for gateway WebSocket connection
      CLAWDBOT_API_TOKEN: "${CLAWDBOT_API_TOKEN}"
      CLAWDBOT_URL: "ws://host.docker.internal:18789"
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true

volumes:
  guardian-data:
